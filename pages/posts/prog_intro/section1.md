---
title="程序结构导论(1): 编程入门"
subtitle="Python是世界上最好的语言"
description="基本的编程概念: 变量, 表达式, 语句, 控制.
简单python语法: 数据类型, 流程控制, 循环.
万丈高楼平地起, 先从怎么写代码开始吧."
last_modified="2020-11-01 20:14:13"
avatar="/avatar/xhe.png"
publish=true
author="xhe"
license="by-nc-sa"
---

提问, 你是怎么做心算的? 比如, 你有三个数字$1, 2, 4, \dots$, 求和. 首先你$1 + 2 = 3$, 接着你$3 + 4 = 7$, 以此类推. 仔细反省一下你的计算过程, 这整个过程中你做了三件事情:

1. 把两个数字加起来, 拿到一个结果
2. 把结果暂时记住, 比如$1 + 2 = 3$的$3$, 以便和后面数字相加
3. 循环往复的进行步骤1-2, 直到所有数字穷尽

你可以通过反省自己的思考过程找到更多类似的例子, 你的思考不外乎以下的步骤:

1. 把某些事物暂时记住
2. 通过某些事物进行一些推断和计算, 记住一些新事物
3. 循环往复的进行步骤1-2, 直到你满意为止

对应到程序里, **推断/计算/循环就是各种表达式/语句**, 而**暂时记住就对应着变量**. 所以程序总的来说, 就是通过变量存储各种**状态**, 并通过其他结构(如表达式/语句), 对变量进行操作, **改变状态**直到满意为止. 状态可以是整数, 字符串, 或者任何可能的数据.

算盘, 也可以算是一种"计算机". 算盘的珠子位置对应着现在计算好的数字, 也就是**状态**, 一个变量, 打算盘就是在加减这个变量, **改变状态**. 而打算盘的这个人就是"程序".

以上是对程序的一个比喻, 下面介绍具体的python语法. 如果遇到陌生的词, 不要紧, 在别的地方还会见到. 这一大节的内容就是需要来回的看, 因为很多东西都是相互关联的.

## 变量

`b = 3`这条语句声明了一个变量(variable), 名字叫做`b`, 存储着一个整数: $3$.

变量必须有个名字, 这个操作叫做**声明变量**. 下面的语句, 声明了一个变量`b`, 且用`=`运算符, 让变量存储一个整数$3$. `print(b)`会把`b`的值, 那个整数, 输出在屏幕上.

```python
b = 3
print(b) # py
```

不声明变量, 变量就没有名字, 那么你后续就无法指代它. 下面有一个变量$4$, 但他没有名字, 你后续无法对他进行操作, 改变他的值, 所以也叫做**常量(constant)**.

```python
print(4)
```

在声明变量时必须**定义/初始化**, 否则会报错:

```python
b # Error: name 'b' is not defined
```

所以python中, 声明变量和定义变量是一回事, 而且更习惯叫定义变量.

变量都是数据, 数据就有各式各类, 也就是有各种数据类型. 数据类型很复杂, 之后才详细介绍, 不要太纠结.

## 表达式

表达式(expression)是由变量和运算符(`+/-/*/%`之类的)组成的, 类似`(a+b) * 4`.

### 运算符

运算符(operator)按作用数可以分为:

1. `a++`, `--a`, 一元运算符, 也就是只作用于一个变量, 可进一步根据运算符和变量之间的位置细分为前缀`++a`/后缀`a--`
2. `a + b`, 二元运算符, 作用于两个变量, 最常用的一些
3. `a ? b : c`, 三元运算符, 作用于三个变量

运算符按功能可以分为:

1. 算术运算符, 如`a + b`
2. 比较运算符, 如`a < b`
3. 赋值运算符, 如`a = 3`
4. 逻辑运算符, 如`a and 3`
5. 位运算符, 如`a & 3`
6. 其余运算符, 如`a is b`

具体可以参考[菜鸟教程 - python3运算符](//www.runoob.com/python3/python3-basic-operators.html).

### 运算符优先级

表达式有**结合顺序**的问题: `i+++2` 到底是`(i++)+2`还是`i+(++2)`? 或者说它是从左往右结合, 还是从右往左结合? 先结合`++`运算符, 还是先结合`+`运算符?

这得具体语言具体分析, 各种语言的**运算符优先级(operator precendence)**[^coperator]可能不一样.

[^coperator]: [c运算符优先级](//en.cppreference.com/w/c/language/operator_precedence)

对于c来说, 这是`(i++)+2`. 结合顺序可以通过`()`来解决, 这也是推荐的方法: 干脆就不要写让人迷惑的表达式, 直接写`(i++) + 2`.

python的结合顺序和c类似.

### 求值顺序

表达式也有**求值顺序(order of evaluation)**[^csequence]的问题:

[^csequence]: [c求值顺序规则](//en.cppreference.com/w/c/language/eval_order)

```c
i = 3;
i = i++ + 1;
```

最后i的值, 到底是`i++`之后的3, 还是多加1之后的4? 答案是**未定义**[^cundefined]. c语言通过**序列点(sequence point)**来规范求值顺序和结果. c++也继承了c的规范, 不过c++17标准之后大有改动, `i = i++ + 1`在c++17之后并不是未定义行为.

[^cundefined]: [c未定义行为](//en.cppreference.com/w/c/language/behavior)

python的表达式的求值顺序和结合顺序是一致的, 不存在这种c语言这种求值顺序, 结合顺序不同的情况.

### 副作用

c语言典型的语句是`c = 3;`赋值语句. 但赋值在c语言中其实是一个表达式: `(c = 3) == 3`. `c = 3;`被判定成语句的原因是末尾的`;`. 很多语言, 表达式加一个终止符`;`, 或者换行后, 就变成了一条语句.

`(c = 3) == 3`这样的表达式, 目的是计算并返回一个值, 但是本例中, 它也完成了一个变量的赋值, 这次赋值是表达式的**副作用(side effect)**. 还有一类常见副作用是IO操作, `printf("xx")`有返回值, 但你甚至可能从来都没用过. 它的主要作用, 打印到屏幕上, 其实是它的副作用.

**但是, 副作用并非必要**. 副作用几乎可以说是 **命令式编程(imperative programming)** 的特产. 有很多不同的方法可以抽象计算外的其他操作: 虽然大家都用语句抽象, 但可以用不同的方式去抽象. 比如, Haskell这个 **函数式编程(functional programming)** 语言中的**Monad**[^monad]. 或者SQL这种典型的 **声明式编程(declarative programming)** .

[^monad]: [haskell IO](//www.jianshu.com/p/7f715d4695ee)

## 语句

python是一门基于**缩进(indention)**的编程语言: python没有花括号, 不需要写分号. 作为替代, python需要保持正确的缩进, 来保证程序可以正常被解析. 你马上会见到例子.

### 条件控制

```python
a = 1
if a == 2:
	print('a')
	print('c')

print('b')
```

以上代码输出`b`, 以下代码也输出`b`:

```python
a = 1
if a == 1:
	print('b')
else
	print('a')
```

`if`是条件判断语句, 后面跟着的是表达式, 如果表达式求值为**真(true)**, 就执行下面的代码. 这里下面的代码指的是, `if a == 1:`这一行下面比本行多一个tab或几个空格的行(直到不满足条件为止).

如果条件为**假(false)**, 就执行`else`下面的代码(如第二个例子), 或者接着执行后面的代码(如第一个例子). 但是条件判断可以级联:

```python
a = 1
if a == 2:
	print('c')
elif a == 3:
	print('b')
else
	print('a')
```

以上代码输出`a`, 首先判断`a == 2`得到假, 随后执行`a == 3`又得到假, 所以只好执行`else`下面的代码.

具体可以参考[菜鸟教程 - python3控制](//www.runoob.com/python3/python3-conditional-statements.html).

### 循环

以下代码输出4个a.

```python
a = 3
while a >= 0:
	print('a')
	a -= 1
```

while循环的执行, 直到条件为假才结束, 但可以提前使用break结束. 下面代码只输出2个a:

```python
a = 3
while a >= 0:
	print('a')
	a -= 1
	if a == 2:
		break
```

还可以使用continue跳过执行, 下面代码什么都不输出:

```python
a = 3
while a >= 0:
	a -= 1
	continue
	print('a')
```

还有另一for循环, 也可以使用break和continue, 以下代码输出3个a:

```python
for a in range(3):
	print('a')
```

和别的语言不太一样的是, 循环语句后面可以跟`else`, 下面代码输出3个a, 1个b:

```python
for a in range(3):
	print('a')
else:
	print('b')
```

具体可以参考[菜鸟教程 - python3循环](//www.runoob.com/python3/python3-loop.html).

### 函数

函数和变量一样都有一个名字, 只不过函数存储的是代码本身: 它就像数学的函数一样接受输入, 处理后返回输出, 而处理的代码是由你来定义的. 下面定义了一个叫做`sum`的函数, 接受两个叫做`a`, `b`的变量, 或者说**参数(argument)**, 返回两个参数的和:

```python
def sum(a, b):
	return a + b

sum(3, 4) # 7
```

`def sum(a, b):`下面的是函数体, 需要比`def`多缩进一个tab, 或几个空格. 而形如`sum(3, 4)`这样的语句被叫做函数调用, 通过名字执行预先定义好的过程, 进行代码的重复利用.

`return`是一个关键字, 标志着函数执行到这里就结束了, 下面的函数中`a = 3`不会被执行:

```python
def sum(a, b):
	return a + b
	a = 3 # not executed
```

当然, 函数也可以没有返回值.

具体可以参考[菜鸟教程 - python3函数](//www.runoob.com/python3/python3-function.html).

## 数据类型

给出数据34, 求它对应的十进制数字. 答案可以是34, 但也可以是52, 还可以是28. 这三个答案分别对应34是十进制, 十六进制, 八进制时, 对应的十进制大小. 因此一个数据可以有不同解释, 如果附加条件不同的话.

在编程语言中也有类似情况, 根据**类型(type)**不同, 数据可以有两种解释. 你对不同类型的变量, 能进行的操作也是不同的.

### 类型声明

编程语言按是否需要显式声明变量的类型分为强类型, 弱类型两种编程语言.

下面是c语言中的变量定义, 每个变量都有具体的类型, 比如c的类型是`int`, `string`的类型是`char*`, 所以是强类型语言.

```c
int c = 1;
char string[] = "hello";
```

强类型语言不存储变量信息, 即c语言并不关心底层存储的是什么数据. 恰恰相反, c语言会根据你给予的类型进行解释. 举个例子:

```c
int c = 1;
char *string = (char*)(&c);
```

通过强制类型转换整数为字符串, `string`这个字符串变量指向了变量c, 也就是指向了1. 但是打印[`printf("%s", string)`]结果并不是1, 因为`string`是个字符串变量. 所以它会把1对应的二进制数据`0x00000001`解释为一个字符串. 按字符串解释方法, 每两个十六进制数, 即每byte对应一个字符, `0x00`是字符串的终止符, `0x01`是不可打印的控制字符. 所以不管怎么样, 结果中都不可能出现1.

下面是py语言中的变量定义, 除了名字初始值什么都没有, 所以是弱类型语言. 弱类型语言并非没有类型, 而是把类型信息通过某种方式隐藏, 你看不到, 也不需要看到. 程序自动检查类型信息, 遇到数字就输出数字, 遇到字符串就输出字符串. 一般来说, 类型信息是紧跟这变量存储的.

```py
c = 1
string = 'hello'
```

这两类语言共同点是, 不管是哪种语言, 都是通过类型信息来解释底层的二进制数据, 进行不同的操作. 区别只在于需不需要声明变量类型; 运行时还是编译时推断类型; 类型信息是怎么存储的.

### 数字

python中的数字分三种: 整数(int), 浮点数(float), 复数(complex).

整数可以用八进制(octal), 十进制(decimal), 十六进制(hexadecimal)表示:

```python
37 # decimal
0o37 # octal
0x37 # hex
```

由于计算机内存有限, 一个变量能表示的数字有上下限, 只能表示区间$[a, b]$之内的数.

浮点数, 即实数, 遵循IEEE 754实现, 同样由于现实原因, 浮点数有上下限, 且计算时容易丢失精度, 造成结果不正确:

```python
3.2
.3
3e2
3e-2
```

复数由两个浮点数组成, 通过`complex`函数构建, 可以通过`.real/.imag`获取实部/虚部:

```python
c = complex(1, 2) # 1.0 + 2.0j
c.real # 1.0
c.imag # 2.0
```

复数例子中, $1$和$2$都是整数, 但被**隐式(implicit)**转换为浮点数, 或者说自动转换. 你也可以**显式(explicit)**, 或者说手动转换:

```python
a = int(1.0) # 1
b = float(1) # 1.0
```

具体可以参考[菜鸟教程 - python3数字](//www.runoob.com/python3/python3-number.html).

### 字符串

python没有char类型, 所有字符相关的都是字符串, 既可以使用单引号, 可以用双引号:

```python
"hello"
'hello'
```

因为**解析(parse)**代码时, 技术上的一些原因, 在定义字符串时, 其中某些字符需要**转移(escape)**, 比如双引号需要写成`\"`:

```python
"f\"ee\"" # 'f"ee"'
```

字符串, 顾名思义, 是一串字符, 所以自然可以通过数字可以获取其中某个, 或某些字符:

```python
a = "hello"
a[0] # 'e'
a[3] # 'l'
a[1:3] # 'el'
a[:4] # 'hell'
a[3:] # 'lo'
a[-3:] # 'llo'
```

字符串虽然不是数字, 但作为变量, 也可以对它使用运算符, `a[3]`, `a[3:]`本质上是一元运算符. 二元的有`+`拼接运算符:

```python
a = 'h' + 'e'
print(a) # 'he'
```

比较特别的是`%`这个二元运算符, 它可以用来做**格式化(formatting)**:

```python
print("%d + %d = %d" % (1, 2, 3)) # 1 + 2 = 3
```

其中`"%d + %d = %d"`是格式化字符串, `%d`叫做**格式符(format specifier)**. 右侧是一个元组, 其中每一个变量都对应一个格式符. 最终输出的字符串中, 每个格式符都会被替换成, 元组中对应的变量的字符串形式.

具体可以参考[菜鸟教程 - python3字符串](//www.runoob.com/python3/python3-string.html)

### 列表

**列表(list)**是一串有序的变量, 可以插入新的变量, 删除旧的变量, 改变现有变量:

```python
a = [1, 2, 'str']
del a[0] # delete 1 from the list a
a # [2, 'str']
```

和字符串一样可以使用`[]`和`[:]`运算符:

```python
a = [1, 2, 'str']
a[0] # 1
a[1:] # [2, 'str']
a[-3:] # [1, 2, 'str']
```

列表其实是一个**对象(object)**, 他有很多**方法(methods)**用来做很多事情, 这是面向对象编程的概念. 比如列表的方法`count`, 会返回列表中变量的个数:

```python
a = [1, 2, 2, 'str']
a.count(2) # 2
```

简单来说, 方法可以理解为一个函数, 但是自动的多接受一个输入, 也就是对象这个变量本身作为输入. 举个例子, 如果先忽略怎么实现`count`方法的问题, 上面的可以重写为:

```python
def count_us(list, elem):
	# count code here

a.count(2) == count_us(a, 2) # True
```

具体可以参考[菜鸟教程 - python3列表](//www.runoob.com/python3/python3-list.html)

### 元组

**元组(tuple)**是一串有序的变量, 和列表类似. 但是元组本身不允许被修改, 一经定义, 存储的变量就已经固定, 但是变量本身可以被修改:

```python
a = (1, 2, 'str')
a = 1, 2, 3
>>> del a[0]
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: 'tuple' object doesn't support item deletion
```

和字符串一样可以使用`[]`和`[:]`运算符:

```python
a = (1, 2, 'str')
a[0] # 1
a[1:] # [2, 'str']
a[-3:] # [1, 2, 'str']
```

元组也是一个对象, 也有很多方法.

具体可以参考[菜鸟教程 - python3元组](//www.runoob.com/python3/python3-tuple.html)

### 集合

**集合(set)**和数学里的类似, 无序, 不重复:

```python
{1, 2}
set((1, 2))
set() # empty set
```

注意, 空集合定义不能使用`{}`, 因为这定义了一个字典. 集合是一个对象, 有很多方法.

具体可以参考[菜鸟教程 - python3集合](//www.runoob.com/python3/python3-set.html)

### 字典

**字典(dictionary)**可以看成是存储了一堆元组的集合, 判断重不重复以元组的第一个变量为依据:

```python
{} # empty dict
{'first': 1, 'second': 2}
{'first': 1, 'second': 2, 'first': 3} # {'first': 1, 'second': 2}
```

只可以使用`[]`运算符:

```python
a = {'first': 1, 'second': 2}
a['first'] # 1
a['second'] # 2
```

字典是一个对象, 有很多方法.

具体可以参考[菜鸟教程 - python3字典](//www.runoob.com/python3/python3-dictionary.html)

## python vs 其他语言

下面列举一些python和其余语言的差别.

c语言可以只声明变量, 却不定义, 下面声明了变量a存在, 但没有指定它最开始的值是什么.

```c
int a;
```

javascript语言非严格模式下, 不需要提前声明变量, 未声明的变量有一个默认值`undefined`:

```js
console.log(a) // output: undefined
```
